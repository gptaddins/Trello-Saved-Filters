<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Saved Filters Power-Up</title>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
</head>
<body>
  <script>
    window.TrelloPowerUp.initialize({
      'board-buttons': function(t, options) {
        return [{
          icon: 'https://avatars.githubusercontent.com/u/224228586', // Your app icon
          text: 'Filters',
          callback: function(t) {
            return t.showSettings({
              url: './settings.html',
              height: 600 // Adjust based on content
            });
          }
        }];
      },
      'card-badges': function(t, options) {
        return t.card('all').then(function(card) {
          var query = t.get('board', 'private', 'activeQuery', '');
          if (query) {
            return t.getRestApi().getToken().then(function(token) {
              var appKey = '72d09526a2855680e12a04e38b04637c';
              var url = 'https://api.trello.com/1/search?query=' + encodeURIComponent(query) +
                        '&modelTypes=cards&cards_limit=100&key=' + appKey + '&token=' + token;
              return fetch(url).then(function(response) {
                return response.json();
              }).then(function(data) {
                if (data.cards && data.cards.some(c => c.id === card.id)) {
                  return [{
                    text: 'âœ“', // Filter match indicator
                    color: 'green'
                  }];
                }
                return [];
              });
            });
          }
          return [];
        });
      },
      'show-settings': function(t, options) {
        return t.get('board', 'private', 'activeQuery', '').then(function(query) {
          return {
            url: './settings.html',
            args: { query: query },
            height: 600
          };
        });
      }
    }, {
      appKey: '72d09526a2855680e12a04e38b04637c',
      appName: 'Saved Filters',
      appAuthor: 'GPT AddIns'
    });
  </script>
</body>
</html>
